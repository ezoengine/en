<link rel="import" href="bower_components/polymer/polymer.html">
<script src="jquery-2.1.1.min.js"></script>

<polymer-element name="x-word" attributes='size'>
<template>
  <link rel='stylesheet' href="en.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Droid+Sans+Mono:700,400,300">
   <div id='ctx'>
  	<input id='i' type='input' value=''>
  </div>
</template>
<script>
	Polymer({
		size: 52,
		ready:function(){
		},
		attached: function () {
			this.word = this.innerHTML;
			this.innerHTML = '';
			this.initField();
			this.keyinEvent();
		},
		initField : function(){
			var len = this.word.length;
			this.$.i.style.width = len*this.size*5/7+'px';
			this.$.ctx.style.width = len*this.size*5/7+'px';
			this.$.i.setAttribute('maxlength',len);			
		},
		keyinEvent: function(){
			var self = this;
			this.$.i.addEventListener('keyup',function(e){
				//console.log('keyCode',e.keyCode);
				var val = self.$.i.value;
				self.verify();
				if(self.word.length == val.length && 
					e.keyCode!=9 /*tab*/ && e.keyCode!=16 /*shift*/){
					self.focusNext();
				} else if(val.length==0 && e.keyCode==8){
					self.focusPrev();
				}
			});
		},
		verify:function(){
			if(this.word === this.$.i.value){
					this.repaceEle();
			}
		},
		repaceEle:function(){
			this.$.i.parentNode.removeChild(this.$.i);
			var txt = document.createTextNode(this.word);
			this.$.ctx.appendChild(txt);
			$(this.$.ctx).css({
				'transition-duration':'1s',
				'background-color':'#fff',
				'margin': '4px 3px 4px 3px'
				});
			this.setAttribute('done','');
		},
		focus:function(){
			if(this.getAttribute('done')!=null){
				this.focusNext();
			};
			this.$.i.focus();
		},
		focusNext:function(){
			console.log('next',$(this).next('x-word'));
			$(this).next('x-word').focus();
		},
		focusPrev:function(){
			$(this).prev('x-word').focus();
		}
	});
</script>
</polymer-element>